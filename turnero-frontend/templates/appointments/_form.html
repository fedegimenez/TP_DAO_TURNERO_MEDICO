<div class="card">
  <h3 class="text-lg font-semibold text-slate-800">Nuevo turno</h3>
  <p class="text-sm text-slate-500 mb-3">Seleccioná paciente, profesional y fecha para agendar el turno.</p>
  {% if success %}
  <div class="alert-success mb-3">{{ success }}</div>
  {% endif %}
  {% if error %}
  <div class="alert-error mb-3">{{ error }}</div>
  {% endif %}
  <form hx-post="/turnos/crear" hx-target="#appointment-form" hx-swap="outerHTML" class="space-y-3">
    <div>
      <label class="lbl">Paciente</label>
      <select class="input" name="paciente_id" required>
        <option value="" disabled {% if not values.get('paciente_id') %}selected{% endif %}>Seleccioná paciente</option>
        {% for p in pacientes %}
        <option value="{{ p.id }}" {% if p.id|string == values.get('paciente_id')|string %}selected{% endif %}>{{ p.apellido }}, {{ p.nombre }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="lbl">Médico</label>
      <select class="input" name="medico_id" required>
        <option value="" disabled {% if not values.get('medico_id') %}selected{% endif %}>Seleccioná médico</option>
        {% for m in medicos %}
        <option value="{{ m.id }}" {% if m.id|string == values.get('medico_id')|string %}selected{% endif %}>{{ m.apellido }}, {{ m.nombre }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="lbl">Especialidad</label>
      <select class="input" name="especialidad_id" required>
        <option value="" disabled {% if not values.get('especialidad_id') %}selected{% endif %}>Seleccioná especialidad</option>
        {% for e in especialidades %}
        <option value="{{ e.id }}" {% if e.id|string == values.get('especialidad_id')|string %}selected{% endif %}>{{ e.nombre }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="grid grid-cols-2 gap-3">
      <div>
        <label class="lbl">Fecha</label>
        <input type="date" class="input" name="fecha" required value="{{ values.get('fecha', '')[:10] }}">
      </div>
      <div>
        <label class="lbl">Hora</label>
        <input type="time" class="input" name="hora" required value="{{ values.get('fecha', '')[11:16] }}">
      </div>
    </div>
    <div>
      <label class="lbl">Duración</label>
      <select class="input" name="duracion_min">
        {% for minutes in [20, 30, 45, 60] %}
        <option value="{{ minutes }}" {% if values.get('duracion_min')|int == minutes %}selected{% endif %}>{{ minutes }} minutos</option>
        {% endfor %}
      </select>
    </div>
    <button class="btn-primary w-full">Agendar turno</button>
  </form>
</div>
{% if turnos %}
  {% set pac_map = pacientes_map %}
  {% set med_map = medicos_map %}
  {% set esp_map = especialidades_map %}
  <div id="appointments-table" hx-swap-oob="outerHTML">
    {% include "appointments/_table.html" with context %}
  </div>
{% endif %}
